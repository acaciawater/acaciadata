{% extends 'sensor/base.html' %}
{% load staticfiles %}
{% load i18n %}
{% block title %}Datalogger verplaatsen{% endblock title %}
{% block script %}
{{ block.super }}
<script>

$(function() {
	const api = '/api/v1'
	$("#id_logger").change(function(e) {
		const id = this.value
		if (id) {
			// get current installation
			fetch(`${api}/loggers/${id}/current`).then(response => {
				response.json().then(data => {
					console.debug(data)
					$("#id_cur_screen").val(data.screen)
					$("#id_cur_refpnt").val(data.refpnt)
					$("#id_cur_depth").val(data.depth)
					$("#id_depth").val(data.depth)
				})
			})
		}
	})	
	$("#id_screen").change(function(e) {
		const id = this.value
		// get refpnt of screen
		fetch(`${api}/screens/${id}`).then(response => {
			response.json().then(data => {
				console.debug(data)
				$("#id_refpnt").val(data.refpnt)
			})
		})		
	})
	$("#id_logger").change()
})

</script>
{% endblock %}
{% block content %}
<form method="post">{% csrf_token %}
	<div class="container">
	<h3>Datalogger verplaatsen</h3>
	<table class="table table-striped">
	<thead></thead>
	<tbody>
	<tr>
		<td>Datalogger</td>
		<td>{{form.logger}}</td>
	</tr>
	<tr>
		<td>Huidig filter</td>
		<td>{{form.cur_screen}}</td>
	</tr>
	<tr>
		<td>Huidig ophangpunt</td>
		<td>{{form.cur_refpnt}}</td>
	</tr>
	<tr>
		<td>Huidige kabellengte</td>
		<td>{{form.cur_depth}}</td>
	</tr>
	<tr>
		<td>Tijdstip stoppen</td>
		<td>{{form.stop_date}}&nbsp;{{form.stop_time}}
		{% if form.errors.stop_time %}
			<span class="alert alert-danger">{{form.errors.stop_time|join:', '}}</span>
		{% endif %}
		</td> 
	</tr>
	<tr>
		<td>Nieuw filter</td>
		<td>{{form.screen}}</td>
	</tr>
	<tr>
		<td>Nieuw ophangpunt</td>
		<td>{{form.refpnt}}</td>
	</tr>
	<tr>
		<td>Nieuwe kabellengte</td>
		<td>{{form.depth}}</td>
	</tr>
	<tr>
		<td>Tijdstip starten</td>
		<td>{{form.start_date}}&nbsp;{{form.start_time}}
		{% if form.errors.start_time %}
			<span class="alert alert-danger">{{form.errors.start_time|join:', '}}</span>
		{% endif %}
		</td>
	</tr>
	</tbody>
	<tfoot>
		<tr>
			<td colspan=2>
			<input type="submit" value="Verplaatsen" class="btn btn-primary">
			<button type="button" onclick="history.back()" class="btn btn-secondary">Annuleren</button>
			</td>
		</tr>
	</tfoot>
	</table>
	</div>
</form>
{% endblock %}